<!DOCTYPE html>
<html lang="en">
  <head>
    <title>TrailGuard</title>

    <meta charset="UTF-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="description" content="" />
    <link rel="icon" href="TG.png">
    
    <!--calls for the arcgis api's CSS file and JS library-->
    <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.25/"></script>

    <!--CSS to make a full screen map-->
    <style>  
    html,  
    body,  
    #viewDiv {  
      padding: 0;  
      margin: 0;  
      height: calc(100% - 50px);  
      width: 100%;  }

      body {
    font-family: "Century Gothic", sans-serif; /* Font used in IATA brand */
    }

      .addRecordBtn {
      position: "absolute";
      z-index: 10;
      top: 10px;
      right: 10px;
      background-color: #ff6700;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      text-decoration: none;
    }

    .addRecordBtn:hover {
      background-color: #ff6700;
    }

    .header {
      display: flex;
      justify-content: space-between; 
      align-items: center; 
      text-align: left;
      background: #0077D4; /* IAT blue */
      color: rgb(255, 255, 255);
      padding: 10px 20px; 
      height: 50px;
    }
      .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      padding-top: 100px; /* Location of the box */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(82, 36, 36); /* Fallback color */
      background-color: rgba(141, 30, 30, 0.4); /* Black w/ opacity */
      text-align: center;
      }

      .modal-content {
      background-color: #e7e7e7;
      margin: auto;
      padding: 20px;
      border: 8px solid #888;
      width: 80%;
      max-height: 80vh; /* This will limit the height to 80% of the viewport height */
      overflow-y: auto; /* This will allow vertical scrolling if the content exceeds the max height */
    }

      .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }

      .close:hover,
      .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
      }
      
    

    </style> 

    <!--adding the modules for the app-->
    <script>
    require([
        "esri/config", 
        "esri/Map", 
        "esri/views/MapView",
        "esri/widgets/BasemapGallery",
        "esri/widgets/Locate",
        "esri/widgets/Search",
        "esri/widgets/Expand",
        "esri/layers/FeatureLayer",
        "esri/renderers/SimpleRenderer",
        "esri/symbols/SimpleLineSymbol",
        "esri/Color",
        "esri/widgets/Editor",
        "esri/widgets/Legend",
        "esri/widgets/LayerList"
    ], function(esriConfig, Map, MapView, BasemapGallery, Locate, Search, Expand, FeatureLayer, SimpleRenderer, SimpleLineSymbol, Color, Editor, Legend, LayerList) {

    //add API key
    esriConfig.apiKey = "AAPKddba40c16f2c479188ee7654064642bcKj2RV3mAHrsiJS_6TRKUzkim46MXbNeE97z3bQn0zq3zyX67A3i8hBg6lEH0Fxl_"
    //create map w grey basemap layer
    const map = new Map({
      basemap: "arcgis-light-gray" //basemap layer
    });

    //view of Wisconsin
    const view = new MapView({
      map:map,
      center: [-89.585655,  43.999906], //longitude, latitude
      zoom: 6, //zoom level
      container: "viewDiv" //Div element
    });

    //expand and add widget for basemap gallery
    const bgExpand = new Expand({
      view: view,
      content: new BasemapGallery({
        view: view,
       })
    });
    view.ui.add(bgExpand, "top-right");

    //create a locate widget instance and add it to the view
    const locate = new Locate({
        view: view
    });
    view.ui.add(locate, "top-left");

    // Create a Search widget instance 
    const search = new Search({
      view: view,
      suggestionsEnabled: true,
      maxSuggestions: 3
    });
      
    //expand the search widget 
    const searchExpand = new Expand({
      view: view,
      content: search,
      expandIconClass: "esri-icon-search",
      expandTooltip: "Search",
      expanded: false
    })
    //add the search widget to the top left corner of the view
    view.ui.add(searchExpand, {
      position: "top-left",
      index: 2
    });

    // Create a LayerList widget
    const layerList = new LayerList({
        view: view
    });
    
    // Put the LayerList widget into an Expand widget
    const layerListExpand = new Expand({
      view: view,
      content: layerList,
      expandIconClass: "esri-icon-layer-list",
      expandTooltip: "Layers"  // Tooltip text for the button
    });
    // Add the Expand widget to the view
    view.ui.add(layerListExpand, "top-right");

    // Create a Legend widget instance 
    const legend = new Legend({
      view: view
    });

    //Put legend widget into an expand widget and add it to the view
    const legendExpand = new Expand({
      view: view,
      content: legend,
      expandIconClass: "esri-icon-legend",
      expandTooltip: "Legend",
    });
    view.ui.add(legendExpand, "bottom-left");

    //create editor widget instance and add it to the view
    const editor = new Editor({
      view: view,
      //layerInfos: [lineInfos]
    }); 

    //expand the editor widget
    const editorExpand = new Expand({
      view: view,
      content: editor,
      expandIconClass: "esri-icon-edit",
      expandTooltip: "Add Completed Segments",
      expanded: false
    });
    //add the editor widget to the view
    view.ui.add(editorExpand, "top-right");

    //define a popup template for the sections feature layer
    const sectionsPopupTemplate = {
      title: "Section or Connecting Route",
      content: [
        {
          type: "text",
          text: `<b>Name: </b> {Segment} <br>
                <b>Type: </b> {Status} <br>`
        },
        {
          type: "fields",
          fieldInfos: [{
            fieldName: "length_mi",
            label: "Length",
              format: {
                places: 1,
                digitSeparator: true
              }
            }]
        }
      ]
    };

    //define a popup template for the parking feature layer
    const parkingPopupTemplate = {
      title: "Parking Area",
      content: `<b>Parking Type: </b> {Parking_Type} <br>
                <b>Description: </b> {Description} <br>
                <b>Fee: </b> {Fee} <br>
                <b>Overnight Parking: </b> {Overnight_Park}<br>
                <b>Comment: </b> {Comment} <br>`
    }

    //define a popup template for the camping feature layer
    const campingPopupTemplate = {
      title: "Camping Area",
      content: `<b>Type: </b> {Camp_Type} <br>
                <b># sites: </b> {Num_sites} <br>
                <b>Water: </b> {Water} <br>
                <b>Toilet: </b> {Toilet} <br>
                <b>Showers: </b> {Showers}<br>
                <b>Description: </b> {Description}`
    }

    //define a popup template for the water feature layer
    const waterPopupTemplate = {
      title: "Potential Water Source",
      content: `<b>Potability: </b> {Potability} <br>
                <b>Reliability: </b> {Reliability} <br>
                <b>Description: </b> {Description}`
    }

    //make section lines brown
    const sectionsRenderer = new SimpleRenderer({
      symbol: new SimpleLineSymbol({
        color: new Color([86, 63, 35]),
        width: "3px"
      })
    });

    //add sections layer 
    const sections = new FeatureLayer({
      url: "https://services.arcgis.com/EeCmkqXss9GYEKIZ/arcgis/rest/services/IAT_Segments_CR/FeatureServer",
      title: "IAT Sections and Connecting Routes",
      renderer: sectionsRenderer,
      //add the popup template
      outFields: ["Segment", "length_mi", "Status"],
      popupTemplate: sectionsPopupTemplate
    });
    map.add(sections);
    
    //add the feature layer for IAT parking lots
    const parking = new FeatureLayer({
      url: "https://services.arcgis.com/EeCmkqXss9GYEKIZ/arcgis/rest/services/IAT_Parking/FeatureServer",
      title: "Parking Areas",
      //add the popup template
      outFields: ["Parking_Type", "Comment", "Description", "Fee", "Overnight_Park"],
      popupTemplate: parkingPopupTemplate
    });
    map.add(parking);

    //add the feature layer for IAT camping areas
    const camping = new FeatureLayer({
      url: "https://services.arcgis.com/EeCmkqXss9GYEKIZ/arcgis/rest/services/IAT_Camping1/FeatureServer",
      title: "Camping Areas",
      //add the popup template
      outFields: ["Camp_Type", "Num_Sites", "Water", "Toilet", "Showers", "Description"],
      popupTemplate: campingPopupTemplate
    });
    map.add(camping);

    //add feature layer for water
    const water = new FeatureLayer ({
      url:"https://services.arcgis.com/EeCmkqXss9GYEKIZ/arcgis/rest/services/IAT_Potable_Water/FeatureServer",
      title: "Potable Water",
      //add the popup template
      outFields: ["Potability", "Reliability", "Description"],
      popupTemplate: waterPopupTemplate
    });
    map.add(water);

    //community icon renderer
    const communityRenderer = {
      type: "simple",
      symbol: {
        type: "picture-marker",
        url: "https://ecolville.github.io/TrailGuard/Generic-Trail-Community-Logo.png",
        width: "20px",
        height: "20px"
      }
    };

    //add the feature layer for IAT communities
    const communities = new FeatureLayer({
      url: "https://services.arcgis.com/EeCmkqXss9GYEKIZ/arcgis/rest/services/Ice_Age_Trail_Communities_View/FeatureServer",
      title: "Trail Communities",
      renderer: communityRenderer,
    });
    map.add(communities);
    //add popup template
    communities.popupTemplate = {
    title: "{Name}"
    }

    //add hazards feature layer that's created by survey123 data
    const hazards = new FeatureLayer ({
      url:"https://services1.arcgis.com/kkX9mRo34fTGAX96/arcgis/rest/services/survey123_28999d44a3004264b788805abd470022_results/FeatureServer",
      title: "Trail Hazards & Maintenance Issues",
      renderer: {
        type: "simple",
        symbol: {
          type: "picture-marker",
          url: "https://ecolville.github.io/TrailGuard/hazard.png",
          width: "20px",
          height: "30px"
        },
      }
    });
    map.add(hazards);

    //popup template for the trail hazards
    hazards.popupTemplate = {
      title: "Trail Hazards and Maintenance Issue",
      content: `<b>Date of Observation: </b> {observation_date_and_time} <br>
                <b>Location: </b> {trail_segment_name} {mile_marker} <br>
                <b>Hazard/Maintenence Need: </b> {hazardmaintenance_need} <br>
                <b>Description: </b> {description}<br>
                <b>Severity of Issue: </b> {level_of_severity} <br>`
    };

    //create yellow line for mySegments
    const yellowLineSymbol = new SimpleLineSymbol({
        color: new Color([251, 222, 74]),
        width: "3px",
        style: "solid"
    });

    //render yellow line for mySegments
    const mySegmentsRenderer = new SimpleRenderer ({
      symbol: yellowLineSymbol
    });

    //define the popup template for the editable feature layer (airport)
    const mySegmentPopupTemplate = {
      title: "{SegmentName} Segment Completed",
      content: "on {DateCompleted} <br> {Length_mi} miles"
    }

    //create mySegments Feature Layer
    const mySegments = new FeatureLayer ({
      url: "https://services1.arcgis.com/kkX9mRo34fTGAX96/arcgis/rest/services/Completed_IAT_Segments/FeatureServer",
      renderer: mySegmentsRenderer,
      //adding the mySegment popup 
        popupTemplate: mySegmentPopupTemplate,
        outFields: ["SegmentName", "DateCompleted", "Length_mi"],
        title: "Segment Completed",
    });
    //adding the feature layer to the map
    map.add(mySegments);

});
</script>
</head>
<body>
   <!-- the div to display the header-->
   <div class = "header">
    <h1> TrailGuard: Ice Age Trail Reporter</h1> 
<!--Link to Trail Hazards and Maintenance Issues Survey-->
<a href="https://survey123.arcgis.com/share/28999d44a3004264b788805abd470022"target="_blank" class="addRecordBtn">Report Trail Issue</a>
  </div>
 
  
  <!--the div that displays the map-->
  <div id="viewDiv"></div>

  <!-- the div to add modal-->
  <div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Welcome to the TrailGuard: Ice Age Trail Reporter!</h2>
        <img src ="tag-sale.jpg" alt="Ice Age Trail Alliance" width="300" height="300">
        <p>Dive into your ultimate companion for the Ice Age Trail. As a member of this passionate community, you have a world of features at your fingertips:</p>
        <ul>
          Streamlined Reporting: Quickly and easily report safety hazards and maintenance issues to keep the trail safe and pristine for all.
          Interactive Maps: Navigate confidently with detailed maps highlighting trail segments, campgrounds, water sources, and more.
          Trailhead and Campground Insights: Equip yourself with comprehensive details on amenities, facilities, and unique lodging experiences.
          Track Your Adventures: Celebrate every milestone as you record, track, and conquer segments of the Ice Age Trail.
        </ul>
        <p>With TrailGuard, you're not just hiking—you're actively contributing to the preservation and enjoyment of a national treasure. Dive in, explore, report, and celebrate the Ice Age Trail's splendor with us!</p>
    </div>
</div>
</body>

</html>
 